<?xml version="1.0" encoding="UTF-8"?>
<?if $(var.Platform) = x86 ?>
<?define PlatformProductName = "Htc.Vita.Wix.Extension.Test (32bit)"?>
<?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?else?>
<?define PlatformProductName = "Htc.Vita.Wix.Extension.Test (64bit)"?>
<?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?endif?>
<Wix
    xmlns="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:util="http://schemas.microsoft.com/wix/UtilExtension"
    xmlns:vita="http://www.viveport.com/Htc.Vita.Wix.Extension">
  <Product
      Id="*"
      Name="$(var.PlatformProductName)"
      Language="1033"
      Version="!(bind.FileVersion.DummyApp.exe)"
      Manufacturer="Viveport Software"
      UpgradeCode="69a3692b-df46-4b14-945b-565d974ab889">
    <Package
        InstallerVersion="200"
        Compressed="yes"
        InstallScope="perMachine"
    />
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />
    <Property
        Id="InstallTimeInMilliSec"
        Value="42000"
    />
    <vita:CurrentTimestampFetcher
        Id="FetchCurrentTimestamp_InstallTimeInMilliSec"
        Format="InMilliSec"
        Value="InstallTimeInMilliSec"
    />
    <Property
        Id="InstallTimeInSec"
        Value="42"
    />
    <vita:CurrentTimestampFetcher
        Id="FetchCurrentTimestamp_InstallTimeInSec"
        Format="InSec"
        Value="InstallTimeInSec"
    />
    <Property
        Id="LocalizedName_AuthenticatedUsers"
        Value="Authenticated Users"
    />
    <vita:SidTranslator
        Id="TranslateSid_AuthenticatedUsers"
        Key="S-1-5-11"
        Value="LocalizedName_AuthenticatedUsers"
    />
    <Property
        Id="LocalizedName_Users"
        Value="Users"
    />
    <vita:SidTranslator
        Id="TranslateSid_Users"
        Key="S-1-5-32-545"
        Value="LocalizedName_Users"
    />
    <vita:ServiceManager
        Id="ManageService_Winmgmt"
        Name="Winmgmt"
        StartType="Automatic"
    />
    <Feature
        Id="ProductFeature"
        Title="Htc.Vita.Wix.Extension.Test"
        Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PlatformProgramFilesFolder)">
        <Directory Id="INSTALLFOLDER" Name="Htc.Vita.Wix.Extension.Test" />
      </Directory>
    </Directory>
  </Fragment>

  <Fragment>
    <ComponentGroup
        Id="ProductComponents"
        Directory="INSTALLFOLDER">
      <Component Id="ProductComponents_DummyApp.exe">
        <File
            Id="DummyApp.exe"
            KeyPath="yes"
            Source="$(var.Htc.Vita.Wix.DummyApp.net45.TargetDir)DummyApp.exe">
          <util:PermissionEx
              User="[LocalizedName_AuthenticatedUsers]"
              GenericAll="yes"
          />
        </File>
      </Component>
      <Component Id="ProductComponents_DummyData.txt">
        <File
            Id="DummyData.txt"
            KeyPath="yes"
            Source="DummyData.txt">
          <util:PermissionEx
              User="[LocalizedName_Users]"
              GenericAll="yes"
          />
        </File>
      </Component>
      <Component Id="ProductComponents_InstallTimeReg">
        <RegistryKey
            Root="HKLM"
            Key="Software\HTC\Vita\Wix\Extension\Test"
            ForceCreateOnInstall="yes"
            ForceDeleteOnUninstall="yes">
          <RegistryValue
              Name="InstallTimeInSec"
              KeyPath="yes"
              Type="string"
              Value="[InstallTimeInSec]"
          />
          <RegistryValue
              Name="InstallTimeInMilliSec"
              Type="string"
              Value="[InstallTimeInMilliSec]"
          />
        </RegistryKey>
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
